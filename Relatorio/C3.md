# Elaboração

## Planificação
Numa fase inicial foi discutido com o docente da disciplina o potencial caminho a seguir com este tema, o que resultou numa estrutura inicial de recursos presente no documento de [proposta de tema](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/main/Documentos%20de%20Apoio/DWI_A06927_CamilaOlim_AvaliacaoFinal_Proposta.pdf). 

Numa fase seguinte, algumas tabelas pensadas inicialmente provaram-se bastante mais complexas e extensas do que o esperado, pelo que se seguiu por uma abordagem mais simples, presente no documento [Estrutura_Tabelas](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-2/Documentos%20de%20apoio/Estrutura_Tabelas.pdf) que serviu de apoio e guia ao longo de todo o projeto. O documento encontra-se dividido em duas partes, API e Base de Dados, nas quais foram estruturados, em formato de tabelas, os recursos nessessários para cada uma, os seus campos e respetivos tipos. Foi nesta fase também pensado quais seriam os campos chave e/ou únicos de cada tabela, representados por sublinhado.

Por fim, tomou-se a decião de quais tabelas precisariam de estar ligadas através de tabelas secundárias. Não foi realizado um esquema, no entanto, através dos nomes dados às mesmas, as ligações são de fácil compreensão. 

---

## Estrutura
### Documentação OpenAPI
Após a planificação, iniciou-se a fase de execução pela documentação da API, seguindo o [tutorial](https://moodle.maieutica.pt/pluginfile.php/236631/mod_resource/content/2/INF-DW1-02_OpenAPI3.0.pdf) fornecido pelo docente, através do editor Swagger.

O primeiro passo foi registar no documento as informações do projeto, como o título, descrição e versão, informações de contacto da autora do projeto e, por fim, informações do servidor. De seguida, com o apoio do documento [Estrutura_Tabelas](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-2/Documentos%20de%20apoio/Estrutura_Tabelas.pdf) elaborado na fase anterior, foram descritos os componentes da API e respetivos campos. Em cada componente foram definidos campos obrigatórios e dados exemplos dos campos preenchidos. Por fim, foram definidos e descritos os -paths-, ou seja, os caminhos a seguir no momento de execução de certos servicos do programa e as possíveis respostas de sucesso ou erro.

#### Componentes e _Paths_:  
|  | GET | POST | GET | PUT | DELETE |   
| :----: | :----: | :----: | :----: | :----: | :----: | 
| **Users** | retrieveUsers | createUser | retrieveUser | updateUser | deleteUser |
| **Characters** | retrieveCharacters | createCharacter | retrieveCharacter | updateCharacter | deleteCharacter |
| **Media** | retrieveMedias | createMedia | retrieveMedia | updateMedia | deleteMedia |
| **Posts** | retrievePosts | createPost | retrievePost | updatePost | deletePost |
| **Comments** | retrieveComments | createComment | retrieveComment | updateComment | deleteComment |  

Terminada a documentação, foi gerado um servidor _Nodejs_ que exportou os [ficheiros](https://github.com/inf24dw1g09/DW-Avaliacao-Final/tree/Parte-2/Parte2_%20Ficheiros) necessários para a elaboração da API, descrita em maior detalhe nos capítulos seguintes deste relatório. A versão final da documentação pode ser consultada através do ficheiro [OpenAPI](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-2/Parte2_%20Ficheiros/api/openapi.yaml).

### Base de Dados
Também com o apoio do documento [Estrutura_Tabelas](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-2/Documentos%20de%20apoio/Estrutura_Tabelas.pdf), a base de dados foi criada através do MySQL. Além de criar as tabelas correspondentes aos componentes da API, foram também criadas tabelas de ligação para facilitar a interação entre as principais.  
#### Tabelas:
- Users
- Characters
- Media
  - Character_Media
- Types
  - Media_Type
- Post
  - Cosplay_in_Post
- Comment   

A tabela types existe na base de dados mas não na API propositadamente, uma vez que os tipos de media existentes são uma informação estagnada que não requere serviços para criar, editar ou eliminar. Além disso é apenas uma informação de apoio à Media. A intenção inicialmente era ser possível filtrar a Media por Tipo, no entanto não chegaram a ser efetuados serviços de filtragem.

Para adicionar dados à base de dados, foram utilizados recursos externos semi-automáticos que geraram o código nessessário para a introdução dos mesmos. De forma a evitar possíveis dificuldades ou perda desta informação, este código foi introduzido diretamente no [ficheiro da base de dados](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-2/Parte2_%20Ficheiros/db.sql). O código foi guardado também em [documentos de texto](https://github.com/inf24dw1g09/DW-Avaliacao-Final/tree/Parte-2/Documentos%20de%20apoio/txt%20files) caso fosse necesário. 

---

## Preparação
Nesta fase foi feita a instalação dos módulos necessários através da linha de comandos, a [ligação ao servidor](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-2/Parte2_%20Ficheiros/index.js) e à [base de dados](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-2/Parte2_%20Ficheiros/db.js).

---

## Funcionalidades
### Adaptações
Às funcionalidades geradas automaticamente pela exportação a partir do _Swagger_ foi necessário realizar adaptações para melhor se adequar ao projeto. Inicialmente foram apenas realizadas as adaptações lecionadas pelo docente, seguindo o [tutorial](https://moodle.maieutica.pt/pluginfile.php/236631/mod_resource/content/2/INF-DW1-02_OpenAPI3.0.pdf) do módulo, com os campos necessários para o funcionamento do projeto. Posteriormente, conforme era necessário, foram sendo acrescentadas funcionalidades mais complexas.

Os _Queries_ foram a parte mais complexa deste trabalho e foram necessárias alterações bastante complexas para obter os resultados e ligações pretendidas. O único que não foi alterado mais aprofundadamente foi o GET de todos os elementos da tabela, com exceção do retrieveMedias, uma vez que pretendia exibir o tipo de Media, informação que vinha de uma tabela diferente.   
### Ligações entre tabelas
Sempre que foi necessário utilizar informações de outras tabelas num respetivo _Query_, foram utilizados INNER JOINs e em alguns casos em que o campo podia ser nulo LEFT JOINs. 

Nos serviços de POST, em alguns casos, foi necessário criar um segundo _Query_ dentro do primeiro, para introduzir os dados correetamente nas tabelas de ligação. Nos serviços GET de um item específico da tabela foi adicionada uma condição que apresenta o texto "Error (item) not found" caso este não exista. 

Os serviçoes GET foram dos mais complexos de programar em alguns dos componentes, uma vez que o pretendido era exibir toda a informação relacionada ao item pedido, o que por vezes implicava informação de quase todas as outras tabelas. Por vezes era pretendido expor a informação de uma certa forma, pelo que se recorreu à criação de um objeto. Em casos como por exemplo um Post que pode conter mais do que um cosplayer e personagem, foi utilizada a função _forEach_ para expor corretamente a informação.

Os resultados podem ser consultados nos ficheiros [_Service_](https://github.com/inf24dw1g09/DW-Avaliacao-Final/tree/Parte-2/Parte2_%20Ficheiros/service)

---

## Finalização da API
### Testes e Ajustes
Foram feitos bastantes testes e adaptações, especialmente às _Queries_, até se obter o resultado pretendido e estar todo o programa 100% funcionnal. 
### Retoques Finais
Para terminar, foram feitos pequenos retoques na informação exposta, acrescentados alguns detalhes e editadas algumas do ficheiro de [documentação da API]((https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-2/Parte2_%20Ficheiros/api/openapi.yaml)) que já não faziam sentido ou deveriam ter sido feitos de outra forma.

---

## Preparação da entrega
### Postman
Dada como terminada a API, prosseguiu-se para a criação da coleção de _Postman_ e exportação da mesma. 
### Docker
