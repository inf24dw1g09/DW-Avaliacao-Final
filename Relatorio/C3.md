# Elaboração
##Planeamento
À semelhança da Parte 2, foi novamente realizado um [documento](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/Documentos%20de%20apoio/Estrutura_Tabelas.pdf) de rascunho e apoio à criação e ligação dos recursos da API. Neste documento foram especificados os Models a ser criados, respetivos campos e tipos e as relações que viriam a ser realizadas entre os mesmos. 

## API
### Criação
Para a criação da API aravés do Loopack4 foram seguidas as orientações do [tutorial](https://moodle.maieutica.pt/pluginfile.php/248745/mod_resource/content/1/INF-DW1-06_Loopback4_01.pdf) fornecido pelo docente.

Foram então criados os seguintes modelos, respetivos repositórios e controladores:   
- Users - [Modelo](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/src/lb4-cosplay/src/models/users.model.ts) | [Controlador](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/src/lb4-cosplay/src/controllers/users.controller.ts) | [Repositório](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/src/lb4-cosplay/src/repositories/users.repository.ts)
- Characters - [Modelo](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/src/lb4-cosplay/src/models/characters.model.ts) | [Controlador](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/src/lb4-cosplay/src/controllers/characters.controller.ts) | [Repositório](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/src/lb4-cosplay/src/repositories/characters.repository.ts)
- Medias - [Modelo](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/src/lb4-cosplay/src/models/medias.model.ts) | [Controlador](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/src/lb4-cosplay/src/controllers/medias.controller.ts) | [Repositório](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/src/lb4-cosplay/src/repositories/medias.repository.ts)
- Types - [Modelo](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/src/lb4-cosplay/src/models/types.model.ts) | [Controlador](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/src/lb4-cosplay/src/controllers/types.controller.ts) | [Repositório](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/src/lb4-cosplay/src/repositories/types.repository.ts)
- Posts - [Modelo](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/src/lb4-cosplay/src/models/posts.model.ts) | [Controlador](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/src/lb4-cosplay/src/controllers/posts.controller.ts) | [Repositório](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/src/lb4-cosplay/src/repositories/posts.repository.ts)
- Comments - [Modelo](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/src/lb4-cosplay/src/models/comments.model.ts) | [Controlador](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/src/lb4-cosplay/src/controllers/comments.controller.ts) | [Repositório](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/src/lb4-cosplay/src/repositories/comments.repository.ts)

### Ligações 
Ainda seguindo o mesmo [tutorial](https://moodle.maieutica.pt/pluginfile.php/248745/mod_resource/content/1/INF-DW1-06_Loopback4_01.pdf), foram geradas relações entre os modelos de acordo com os objetivos pretendidos para a API. 

|  | Users | Characters | Media | Types | Posts | Comments | 
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | 
| **Users** |  |  |  |  | hasMany | hasMany |
| **Characters** |  |  | belongsTo |  | hasMany |  |
| **Media** |  | hasMany |  | belongsTo | |  |
| **Types** |  |  | hasMany |  |  |
| **Posts** | belongsTo | belongsTo |  |  |  | hasMany |
| **Comments** | belongsTo |  |  |  | belongsTo |   |  

### Conexão à base de dados
O método de conexão à base de dados do tutorial que foi seguido durante as fases anteriores gerou alguns erros e dificuldades a receber a informação, pelo que se optou por um [método](https://loopback.io/doc/en/lb4/Connecting-to-MySQL.html) alternativo de ligação ao próprio mysql. Para tal foi ainda criada uma nova conexão e uma nova base de dados através do _MySQL Workbench_, que recebeu a informação da criação de tabelas ao correr um ficheiro de migração.   

> Uma vez que todos estes ficheiros foram gerados automaticamente, foram posteriormente realizadas alterações de forma a melhor corresponder às necessidades do projeto ou corrigir alguns erros.

### Testes e Ajustes
Após estes passos, a API aparentava funcionar sem problemas ao utilizar os métodos GET(count), POST, PUT, PATCH e DELETE. No entanto os restantes métodos GET não devolviam a informação corretamente. Foi necessário muito tempo de investigação e tentativas de resolução. Uma das tentativas surgiu da necessidade de introdução de dados na Base de Dados, sendo que solucionaria também este objetivo. Para tal foi feito um pedido de geração de dados a Inteligência Artificial no formato requirido, garantindo que todos os campos estavam preencidos, incluindo aqueles que poderiam ser opcionais. A espectativa era de que o problema fosse a falta de dados, no entanto, não foi atingida uma solução. 

A única possibilidade encontrada foi remover a função _filter_ na totalidade, o que não é de todo ideal, mas foi a única forma de receber a informação e avançar com o projeto. A falta da função _filter_ impediu mais tarde a App de realizar funções de organização de informação que correspondiam a alguns objetivos para o projeto, no entanto foi dada prioridade à possibilidade de avançar e terminar a estrutura base, dado o tempo limitado.

---

## Web App
### Preparação
Nesta fase foi seguido o [tutorial](https://moodle.maieutica.pt/pluginfile.php/249707/mod_resource/content/1/INF-DW1-07_React-Admin.pdf) fornecido pelo docente, que implicou criar a [_React-App_](https://github.com/inf24dw1g09/DW-Avaliacao-Final/tree/Parte-3/src/cosplay-create_react_app), instalar as dependências necessárias e definir a porta de ligação

### Ligação à API
De seguida foram seguidos os passos relativos à ligação do loopback4 com a Web App e introduzidos os recursos relativos ao projeto. A Web App, apesar de estar a receber os dados corretamente, não os interpretava corretamente, uma vez que o programa pedia um campo "id" mas o nome dos campos de ID dados neste projeto eram (campo)_id. Portanto, foi necessário criar uma solução para fazer a "tradução" deste identificador para cada caso individual no ficheiro [App.js](https://github.com/inf24dw1g09/DW-Avaliacao-Final/blob/Parte-3/src/cosplay-create_react_app/src/App.js).

### Introdução dos Métodos
Nesta fase, a App realizava apenas os métodos GET(all) e GET(count) para exibir a informação da base de dados, pelo que foram introduzidos os restantes, com o apoio de [ficheiros](https://github.com/inf24dw1g09/DW-Avaliacao-Final/tree/Parte-3/src/cosplay-create_react_app/src/components) criados de raiz para o efeito. Foi então acrescentada a possibilidade de editar, eliminar e criar itens nas diversas tabelas. Após ultrapassar ligeiras dificuldades, foi possível estas alterações afetarem corretamente a base de dados.

Sem a função _filter_ da API a funcionar, não foi possível acrescentar funcionalidades adicionais de filtragem.

---

## Preparação da entrega
### Postman
Dada como terminada a API, prosseguiu-se para a criação da coleção de Postman e exportação da mesma.

### Docker
Por fim iniciou-se o processo de contentarização dos componentes do projeto.

O primeiro paço foi preparar as portas pelas quais os componentes se passariam a comunicar, uma vez que não poderia ser realizado por comunicação local. De seguida foram criados os ficheiros onde foram definidas as criações das imagens e contentores no docker e as suas respetivas ligações:   
- Docker-Compose
- Dockerfile da BD
- Dockerfile da API

Após correr o Docker-Compose verificou-se que a API funcionava corretamente, no entanto não recebia informação da BD e a _Web App_ não faz de todo qualquer ligação, pelo que não foi possível testar o projeto através do docker.
